<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>บทเรียน – HEAD FACE</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-blue-100 to-blue-300 min-h-screen flex flex-col">

<!-- Header -->
<header class="bg-white shadow-md py-3 px-6 flex justify-between items-center">
  <h1 class="text-lg md:text-xl font-bold text-blue-700">
    บทเรียน&nbsp;<span id="lesson-id"></span>
  </h1>
  <a href="snack.html"
     class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1 rounded-xl font-semibold">
     กลับ Snack
  </a>
</header>

<!-- Content -->
<main class="flex-1 flex items-center justify-center p-4">
  <div id="box"
       class="bg-white rounded-2xl shadow-2xl w-full max-w-xl p-6 space-y-6 text-center
              transition-all min-h-[22rem] flex flex-col justify-between">

    <!-- สไลด์ -->
    <div id="slideArea" class="space-y-4"></div>

    <!-- ปุ่มควบคุม -->
    <div class="flex flex-wrap gap-2 justify-between pt-4 border-t">
      <button id="prevBtn"
              class="flex-1 px-4 py-1 bg-gray-200 rounded text-gray-600 min-w-[5rem]">
        ย้อน
      </button>

      <button id="quizBtn"
              class="flex-1 px-4 py-1 bg-green-500 hover:bg-green-600 text-white rounded min-w-[5rem]">
        ทำ Quiz
      </button>

      <button id="nextBtn"
              class="flex-1 px-4 py-1 bg-blue-600 text-white rounded min-w-[5rem]">
        ถัดไป
      </button>
    </div>

    <!-- Full meal -->
    <button id="fullBtn"
            class="mt-4 w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-xl">
      ดู&nbsp;Full&nbsp;Meal
    </button>
  </div>
</main>

<script>
const API = "https://script.google.com/macros/s/AKfycbxQyMf_zMNuZoa_JLqa2S5LJYgxd1HwDfnMw-3_FtMH-mN2Db72O4xfqpU17zg2mebPkw/exec";

/* ---------- รับ id จาก query ---------- */
const params = new URLSearchParams(location.search);
const chapId = params.get("id");
if(!chapId){
  alert("ไม่พบรหัสบท"); location.href="snack.html";
}
document.getElementById("lesson-id").textContent = chapId;

/* ---------- โหลดสไลด์ ---------- */
let slides = [], idx = 0;
(async()=>{
  const j = await fetch(`${API}?action=get_snack_slides&id=${chapId}`).then(r=>r.json());
  if(j.status!=="success" || j.slides.length===0){
     alert("ไม่พบสไลด์"); location.href="snack.html"; return;
  }
  slides = j.slides; idx = 0; render();
})();

/* ---------- เรนเดอร์ ---------- */
function render(){
  const s = slides[idx];
  const area = document.getElementById("slideArea");

  area.innerHTML = `
    <h2 class="text-blue-700 font-bold">สไลด์ ${idx+1}/${slides.length}</h2>
    ${s.img ? `<img src="${s.img}" class="mx-auto max-h-56 object-contain mb-3">` : ""}
    <p class="text-gray-700 whitespace-pre-wrap text-left">${s.text}</p>
  `;

  document.getElementById("prevBtn").disabled = idx===0;
  document.getElementById("prevBtn").classList.toggle("opacity-30", idx===0);
  document.getElementById("nextBtn").disabled = idx===slides.length-1;
  document.getElementById("nextBtn").classList.toggle("opacity-30", idx===slides.length-1);
}

/* ---------- ปุ่มควบคุม ---------- */
document.getElementById("prevBtn").onclick = ()=>{
  if(idx>0){ idx--; render(); }
};

document.getElementById("nextBtn").onclick = ()=>{
  if(idx < slides.length-1){ idx++; render(); }
};

document.getElementById("quizBtn").onclick = ()=>{
  // ไปหน้า Quiz (เตรียมไว้)
  location.href = `quiz.html?id=${chapId}&mode=snack`;
};

document.getElementById("fullBtn").onclick = ()=>{
  // ไปหน้า Full meal (เตรียมไว้)
  location.href = `fullmeal.html?id=${chapId}`;
};
</script>
</body>
</html>
